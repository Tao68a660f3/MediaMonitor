<Window x:Class="MediaMonitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="媒体同步调试终端 V1.3" Height="850" Width="520" Background="#F0F0F0">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="媒体源:" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,10,0"/>
            <ComboBox x:Name="ComboSessions" DisplayMemberPath="SourceAppUserModelId" SelectionChanged="ComboSessions_SelectionChanged"/>
        </DockPanel>

        <Border Grid.Row="1" Background="White" CornerRadius="5" Padding="15" Margin="0,0,0,10">
            <Border.Effect>
                <DropShadowEffect BlurRadius="5" Color="#DDDDDD" ShadowDepth="1" Opacity="0.5"/>
            </Border.Effect>
            <StackPanel>
                <TextBlock x:Name="TxtTitle" Text="未检测到播放" FontSize="20" FontWeight="Bold"/>
                <TextBlock x:Name="TxtArtist" Text="-" Foreground="#666666"/>
                <ProgressBar x:Name="PrgBar" Height="6" Margin="0,10" Foreground="#0078D7" Background="#E5E5E5"/>
                <TextBlock x:Name="TxtLyricDisplay" Text="等待数据..." FontSize="16" Foreground="#0078D7" TextAlignment="Center" Margin="5"/>
                <TextBlock x:Name="TxtAlbum" Visibility="Collapsed"/>
                <TextBlock x:Name="TxtLyricTranslation" Visibility="Collapsed"/>
                <TextBlock x:Name="TxtNextLyric" Visibility="Collapsed"/>
            </StackPanel>
        </Border>

        <StackPanel Grid.Row="2">
            <Expander Header="通信与显示参数配置" IsExpanded="False" Background="#E1E1E1" Margin="0,0,0,5">
                <Border Background="#F9F9F9" Padding="10">
                    <StackPanel>
                        <UniformGrid Columns="2">
                            <StackPanel Margin="2">
                                <TextBlock Text="串口号:"/>
                                <ComboBox x:Name="ComboPorts"/>
                            </StackPanel>
                            <StackPanel Margin="2">
                                <TextBlock Text="波特率:"/>
                                <ComboBox x:Name="ComboBaud">
                                    <ComboBoxItem Content="9600"/>
                                    <ComboBoxItem Content="115200" IsSelected="True"/>
                                </ComboBox>
                            </StackPanel>
                        </UniformGrid>

                        <TextBlock Text="文本编码:" Margin="2,5,0,0"/>
                        <ComboBox x:Name="ComboEncoding" Margin="2">
                            <ComboBoxItem Content="UTF8" IsSelected="True"/>
                            <ComboBoxItem Content="GB2312"/>
                        </ComboBox>

                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="歌词路径:"/>
                                <TextBox x:Name="TxtLrcPath" Text="C:\Lyrics"/>
                            </StackPanel>
                            <Button Grid.Column="1" Content=" 浏览 " Click="BtnBrowse_Click" Margin="5,15,0,0" VerticalAlignment="Top"/>
                        </Grid>

                        <TextBlock Text="文件名模式:"/>
                        <TextBox x:Name="TxtPatterns" Text="{}{Artist} - {Title};{Title}"/>

                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                            <TextBlock Text="歌词状态: " FontWeight="Bold" FontSize="12"/>
                            <TextBlock x:Name="TxtLrcStatus" Text="等待匹配..." Foreground="Gray" FontSize="12" TextTrimming="CharacterEllipsis"/>
                        </StackPanel>

                        <Separator Margin="0,10"/>
                        <WrapPanel>
                            <CheckBox x:Name="ChkAdvancedMode" Content="协议模式" IsChecked="True" Margin="0,0,15,0"/>
                            <CheckBox x:Name="ChkIncremental" Content="增量预览" IsChecked="True" Margin="0,0,15,0"/>
                            <CheckBox x:Name="ChkTransOccupies" Content="翻译占行" IsChecked="True"/>
                        </WrapPanel>

                        <UniformGrid Columns="2" Margin="0,5">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="屏行数:" VerticalAlignment="Center"/>
                                <TextBox x:Name="TxtScreenLines" Text="3" Width="40" Margin="5,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="偏移:" VerticalAlignment="Center"/>
                                <TextBox x:Name="TxtOffset" Text="1" Width="40" Margin="5,0"/>
                            </StackPanel>
                        </UniformGrid>

                        <Button x:Name="BtnSerialConn" Content="连接串口" Height="30" Margin="0,10,0,0" Click="BtnSerialConn_Click" Background="#0078D7" Foreground="White" BorderThickness="0"/>
                    </StackPanel>
                </Border>
            </Expander>
        </StackPanel>

        <TextBlock Grid.Row="3" Text="实时数据监控:" FontWeight="Bold" Margin="0,5"/>

        <RichTextBox Grid.Row="4" x:Name="HexPreview" Background="#1E1E1E" Foreground="White" 
                     FontFamily="Consolas" IsReadOnly="True" VerticalScrollBarVisibility="Auto">
            <FlowDocument>
                <Paragraph x:Name="InitialPara">等待同步...</Paragraph>
            </FlowDocument>
        </RichTextBox>
    </Grid>
</Window>